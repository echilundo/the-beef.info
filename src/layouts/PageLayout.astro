---
import Head from "@components/Head.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import FloatingButtons from "@components/FloatingButtons.astro";
import ErrorBoundary from "@components/ErrorBoundary.astro";
import LoadingIndicator from "@components/LoadingIndicator.astro";
import SkipLinks from "@components/SkipLinks.astro";
import FocusManager from "@components/FocusManager.astro";
import { SITE } from "@consts";

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <Head title={`${title} | ${SITE.NAME}`} description={description} />

    <!-- Resource hints for better performance -->
    <link rel="preconnect" href="https://cdn.seline.so" />
    
    <!-- SEO Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: dark)" />
    <meta name="description" content={description} />
    <meta property="og:title" content={`${title} | ${SITE.NAME}`} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.href} />
    
    <!-- Critical CSS -->
    <style is:inline>
      /* Prevent layout shift during theme initialization */
      html { visibility: hidden; }
      html.theme-loaded { visibility: visible; }
    </style>

    <!-- Theme initialization with improved error handling -->
    <script is:inline>
      (function() {
        try {
          const theme = localStorage.getItem("theme") || 
            (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
          document.documentElement.classList.toggle("dark", theme === "dark");
          document.documentElement.classList.add("theme-loaded");
        } catch (e) {
          console.warn("Theme initialization failed:", e);
          document.documentElement.classList.add("dark", "theme-loaded");
        }
      })();
    </script>

    <!-- Deferred third-party scripts -->
    <script is:inline async src="https://cdn.seline.so/seline.js" data-token="3e7a569e0f2bcad"></script>
  </head>
  <body class="bg-stone-100 dark:bg-stone-900 text-black dark:text-white">
    <SkipLinks />

    <Header />
    <main id="main-content" role="main" aria-label="Main content">
      <slot />
    </main>
    <Footer />

    <FloatingButtons />

    <ErrorBoundary />

    <LoadingIndicator />

    <FocusManager />

    <!-- Optimized Scripts -->
    <script>
      import "/src/scripts/page-layout.js";
    </script>
  </body>
</html>
